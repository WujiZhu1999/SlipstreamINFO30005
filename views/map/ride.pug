doctype html
html
	head
		link(rel='stylesheet' href='/css/map/map.css')
	body
		div(id="navigation")
			a(class = "a1" href='/') Home
			a(class = "a2" href='/Forum') Forum
			a(class = "a3" href='/Tips') Tips
			a(class = "a4" href=`/Users/${userName}`) Setting
			a(href=`/Friends`) Friends
			form(action="/Login/Logout" method="POST")
				input(type="submit" value= "Logout")
		div(id="mapcontainer")
			div(id="map")
		div(id="realtimeroad")
			p Distance: #{route["distance"]}
			p Duration:	#{route["duration"]*0.265}
			p Turns: #{route["turns"]}
			h2 History:
			if(route["status"].length == 1)
				p Its your first time on this route. GOOD LUCK.
			else
				p Your historical Success: #{route["status"].filter(x => x=="COMPLETED").length}
				p Your historical Failure: #{route["totalTrial"] - route["status"].filter(x => x=="COMPLETED").length}
				p Success Rate: #{route["status"].filter(x => x=="COMPLETED").length/route["totalTrial"]}
		div(id = "routecontroller")
			form(action="/Map/halt" method="post" id = "hault")
				label(for="origin")
				input(type="text" id="origin" name="origin" value=route["origin"])
				label(for="end")
				input(type="text" id="destination" name="destination" value=route["destination"])
			input(type="submit" value="haultRoute" form = "hault")
			form(action="/Map/end" method="post" id = "end")
				label(for="origin")
				input(type="text" id="origin" name="origin" value=route["origin"])
				label(for="end")
				input(type="text" id="destination" name="destination" value=route["destination"])
			input(type="submit" value="endRoute" form = "end")
		div(id = "streetView")
			div(id="viewmap")
			div(id="pano")
	p(id="lat") #{route["response"]["routes"][0]["legs"][0]["end_location"]["lat"]}
	p(id="lng") #{route["response"]["routes"][0]["legs"][0]["end_location"]["lng"]}
	script.
			function initMap() {
				var directionsService = new google.maps.DirectionsService();
				var directionsRenderer = new google.maps.DirectionsRenderer();
				var map = new google.maps.Map(document.getElementById('map'), {
					zoom: 13,
					center: {lat: -37.8105, lng: 144.9624}
				});
				directionsRenderer.setMap(map);
				calculateAndDisplayRoute(directionsService, directionsRenderer);
				initialize();
			}
			function calculateAndDisplayRoute(directionsService, directionsRenderer) {
				directionsService.route({
					origin: {query: document.getElementById("origin").value},
					destination: {query: document.getElementById("destination").value},
					travelMode: 'BICYCLING'
				},
					function(response, status) {
						if (status === 'OK') {
							directionsRenderer.setDirections(response);
						} else {
							window.alert('Directions request failed due to ' + status);
						}
				});
			}
	script.
		function initialize(){
			var _lat = parseFloat(document.getElementById("lat").innerHTML);
			var _lng = parseFloat(document.getElementById("lng").innerHTML);
			var dest = {
				lat:_lat,
				lng:_lng
			};
			var map = new google.maps.Map(document.getElementById("viewmap"),{
				center: dest,
				zoom: 14
			});
			var panorama = new google.maps.StreetViewPanorama(
				document.getElementById("pano"),{
					position: dest,
					pov:{
						heading: 34,
						pitch: 10
					}
				}
			);
			map.setStreetView(panorama);
		}
	script(async defer src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyB3bEc0lmQ6WNX_Cl98IRfu1E5DRLiG2pE&callback=initMap").